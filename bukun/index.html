<HTML>
    <HEAD>
		<link rel="stylesheet" href = "../libs/bootstrap/css/bootstrap.min.css">
        <script type="text/javascript"src="../libs/jquery1.3.2/jquery.min.js"></script>

        <link href="icon.ico" rel="SHORTCUT ICON">

        <title>Bukun</title>
    </HEAD>

    <BODY>
		<form class="col-sm-10 form-horizontal" role="form">
            <hr>

			<div class="form-group">
				<label class="col-sm-2 control-label">週武勲</label>
				<div class="col-sm-10">
					<input id="bukun" type="text" class="form-control"  placeholder="武勲" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">R武勲</label>
				<div class="col-sm-10">
					<input id="bukunR" type="text" class="form-control"  placeholder="武勲" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">SR武勲</label>
				<div class="col-sm-10">
					<input id="bukunSR" type="text" class="form-control"  placeholder="武勲" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">榮耀</label>
				<div class="col-sm-10">
					<input id="glory" type="text" class="form-control"  placeholder="榮耀" />
				</div>
			</div>

			<p class="result text-center"></p>

            <hr>	
			
		</form>
		
		<table class="table">
			<thead>
				<tr>
					<th>週</th>
					<th>標準武勲</th>
					<th>標準SR武勲</th>
					<th>標準R武勲</th>
					<th>標準榮耀</th>
				</tr>
			</thead>
			<tbody>
				<tr class="1-d">
					<td>一</td>
				</tr>
				<tr class="2-d">
					<td>二</td>
				</tr>
				<tr class="3-d">
					<td>三</td>
				</tr>
				<tr class="4-d">
					<td>四</td>
				</tr>
				<tr class="5-d">
					<td>五</td>
				</tr>
				<tr class="6-d">
					<td>六</td>
				</tr>
				<tr class="0-d">
					<td>日</td>
				</tr>
			</tbody>
		</table>
    </BODY>
</HTML>

<script>
	//js-start		
	
	var oldWeekday = -1;

	var bukunReach = [
		{
			bukun: 2000,
			rSRBukun: 500,
			glory: 500
		},
		{
			bukun: 286,
			rSRBukun: 72,
			glory: 72
		},
		{
			bukun: 572,
			rSRBukun: 143,
			glory: 143
		},
		{
			bukun: 858,
			rSRBukun: 215,
			glory: 215
		},
		{
			bukun: 1143,
			rSRBukun: 286,
			glory: 286
		},
		{
			bukun: 1429,
			rSRBukun: 358,
			glory: 358
		},
		{
			bukun: 1715,
			rSRBukun: 429,
			glory: 429
		}
	];

	// init

	for (var key in bukunReach) {
		$('tr.' + key + '-d').append('<td class="wb">' + bukunReach[key].bukun + '</td>');
		$('tr.' + key + '-d').append('<td class="srb">' + bukunReach[key].rSRBukun + '</td>');
		$('tr.' + key + '-d').append('<td class="rb">' + bukunReach[key].rSRBukun + '</td>');
		$('tr.' + key + '-d').append('<td class="wg">' + bukunReach[key].glory + '</td>');
	}

	// ====
	
	if(SetFocusWeekday())
		SetRecord();
	
	window.addEventListener("focus", function(event) { 
			if(SetFocusWeekday())
				SetRecord();
		}, false);
			
	$("#bukun").change(function () {
		SetRecord();
	});
	$("#bukunR").change(function () {
		SetRecord();
	});
	$("#bukunSR").change(function () {
		SetRecord();
	});
	$("#glory").change(function () {
		SetRecord();
	});
	
	function SetRecord () {
		var bukun = $("#bukun").val();
		var bukunR = $("#bukunR").val();
		var bukunSR = $("#bukunSR").val();
		var glory = $("#glory").val();
		
		var weekBukun = bukunReach[oldWeekday].bukun;
		var weekBukunR = bukunReach[oldWeekday].rSRBukun;
		var weekBukunSR = bukunReach[oldWeekday].rSRBukun;
		var weekGlory = bukunReach[oldWeekday].glory;
		
		var diffBukun = Clamp(weekBukun - bukun);
		var diffBukunR = Clamp(weekBukunR - bukunR);
		var diffBukunSR = Clamp(weekBukunSR - bukunSR);
		var diffGlory = Clamp(weekGlory - glory);
		
		$('p.result').text('本日差額 - 週武勲: ' + diffBukun + ' R武勲: ' + diffBukunR + ' SR武勲: ' + diffBukunSR + ' 榮耀: ' + diffGlory);
	}
	
	function Clamp (val) {
		return val;
		//return val >= 0 ? val : 0;
	}
		
	function GetWeekday () {
		var d = new Date();
		d.setHours(d.getHours() - 4);
		return d.getDay();
	}
	
	function SetFocusWeekday () {
		var newWeekday = GetWeekday();
		
		if (oldWeekday == newWeekday)
			return false;
	
		for (var i = 0; i < 7; i++) {
			$('.' + i + '-d').css("background-color", "#FFF");
		}		
		
		$('.' + newWeekday + '-d').css("background-color", "#BCF5A9");
		
		oldWeekday = newWeekday;
		
		return true;
	}

	//js-end
</script>